<main>
  <h2>Shaders Collection</h2>
  <div id="shader-readme" class="shader-readme">Loading shaders...</div>
</main>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
async function fetchShaderReadme() {
  const container = document.getElementById("shader-readme");
  try {
    const res = await fetch("https://raw.githubusercontent.com/hajs110208/Render-dragon-shader-list/main/README.md");
    if (!res.ok) throw new Error("Failed to fetch README.md");
    const markdown = await res.text();

    // Convert Markdown -> HTML
    container.innerHTML = marked.parse(markdown);

    // --- FIX STARTS HERE ---

    // Define base URLs for resolving relative paths
    const imageBaseUrl = "https://raw.githubusercontent.com/hajs110208/Render-dragon-shader-list/main/";
    const linkBaseUrl = "https://github.com/hajs110208/Render-dragon-shader-list/blob/main/";

    // Fix relative image paths
    container.querySelectorAll("img").forEach(img => {
      const originalSrc = img.getAttribute("src");
      // Check if the src is not an absolute URL (doesn't start with http)
      if (originalSrc && !originalSrc.startsWith("http")) {
        // Use the URL constructor for a more reliable way to join paths
        img.src = new URL(originalSrc, imageBaseUrl).href;
      }
    });

    // Fix relative link paths
    container.querySelectorAll("a").forEach(a => {
      const originalHref = a.getAttribute("href");
      // Check if the href is not an absolute URL and not an anchor link
      if (originalHref && !originalHref.startsWith("http") && !originalHref.startsWith("#")) {
        a.href = new URL(originalHref, linkBaseUrl).href;
      }
    });

    // --- FIX ENDS HERE ---

  } catch (err) {
    console.error(err);
    container.innerHTML = "âš  Could not load shaders list.";
  }
}

document.addEventListener("DOMContentLoaded", fetchShaderReadme);
</script>

<style>
  .shader-readme {
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 6px;
    background: #fafafa;
    overflow-x: auto;
  }
  .shader-readme img {
    max-width: 100%;
    height: auto;
    margin: 10px 0;
  }
  .shader-readme a {
    color: #0078d7;
    text-decoration: none;
  }
  .shader-readme a:hover {
    text-decoration: underline;
  }
</style>
